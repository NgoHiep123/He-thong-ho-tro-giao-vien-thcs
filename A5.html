<!DOCTYPE html>
<html lang="vi">
<head>
  <title>Trắc Nghiệm: A5 – Khám phá trình quản lí hệ thống tệp</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body{font-family:'Inter',sans-serif}
    .option-btn:disabled{cursor:not-allowed}
    .correct{background-color:#22c55e!important;color:#fff!important;border-color:#16a34a!important}
    .incorrect{background-color:#ef4444!important;color:#fff!important;border-color:#dc2626!important}
    .note{font-size:12px;color:#6b7280}
  </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 flex items-center justify-center min-h-screen p-4">

  <div id="quiz-container" class="w-full max-w-2xl bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 md:p-8 transform transition-all duration-500">
    <!-- Header -->
    <div class="text-center mb-4">
      <h1 class="text-2xl md:text-3xl font-bold text-gray-800 dark:text-white">Trắc Nghiệm: A5 – Khám phá trình quản lí hệ thống tệp</h1>
      <p class="text-gray-500 dark:text-gray-400 mt-2">Chọn đáp án đúng nhất cho mỗi câu hỏi.</p>
    </div>

    <!-- Thông tin học sinh -->
    <div class="mb-4 grid grid-cols-1 md:grid-cols-2 gap-3">
      <input id="studentName" class="border rounded-lg px-3 py-2 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-100" placeholder="Họ tên">
      <input id="studentClass" class="border rounded-lg px-3 py-2 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-100" placeholder="Lớp">
      <div class="md:col-span-2 note">* Điểm sẽ được gửi lên bảng tính khi bạn hoàn thành bài (yêu cầu Internet).</div>
    </div>

    <!-- Main Game -->
    <div id="main-game">
      <div class="flex justify-between items-center mb-4 text-sm">
        <div id="progress" class="text-gray-600 dark:text-gray-300 font-medium">Câu hỏi 1 / 10</div>
        <div id="score" class="px-3 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-full font-semibold">Điểm: 0</div>
      </div>

      <div id="question-card" class="bg-gray-50 dark:bg-gray-700 p-5 rounded-lg mb-4 min-h-[90px] flex items-center justify-center">
        <p id="question-text" class="text-center text-lg font-semibold text-gray-900 dark:text-white"></p>
      </div>

      <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>

      <div id="feedback-container" class="mt-4 text-center min-h-[24px]">
        <p id="feedback-text" class="font-medium"></p>
      </div>

      <div class="mt-3 flex justify-end">
        <button id="next-btn" class="hidden w-full md:w-auto bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors duration-300 shadow-md disabled:bg-gray-400 disabled:cursor-not-allowed">Câu tiếp theo</button>
      </div>
    </div>

    <!-- Results Screen -->
    <div id="results-container" class="hidden text-center">
      <h2 class="text-3xl font-bold text-gray-800 dark:text-white">Hoàn thành!</h2>
      <p class="text-gray-600 dark:text-gray-400 mt-2">Kết quả của bạn:</p>
      <div class="my-6">
        <p class="text-5xl font-bold text-blue-600" id="final-score"></p>
        <p class="text-lg text-gray-700 dark:text-gray-300 mt-2" id="score-comment"></p>
        <p class="note mt-2" id="send-status">Đang gửi kết quả…</p>
      </div>
      <div class="flex gap-3 justify-center">
        <a href="index.html" class="px-5 py-3 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 font-semibold">Trang chủ</a>
        <button id="restart-btn" class="px-6 py-3 rounded-lg bg-green-500 text-white font-bold hover:bg-green-600 transition-colors duration-300 shadow-lg">Làm lại</button>
      </div>
    </div>
  </div>

  <script>
    // ==== Cấu hình gửi điểm ===
    const QUIZ_ID = "A5";
    const ENDPOINT = "https://script.google.com/macros/s/AKfycbwj9IiX8PXC-bNsh4DGIw0uysx0v3jWPNeu0lQpieUIQAx9sT9YNUKTZoQFBjg-w86TKg/exec";
    let chosen = [];

    // ==== Dữ liệu câu hỏi ====
    const quizData = [
  {question: "Trong Windows, File Explorer là gì?", options: [
    "Trình quản lí hệ thống tệp của Windows.",
    "Trình duyệt web mặc định.",
    "Phần mềm diệt virus.",
    "Trình phát nhạc."
  ], answer: 0},
  {question: "File Explorer có mấy vùng chính?", options: [
    "Hai vùng.", "Ba vùng.", "Bốn vùng.", "Năm vùng."
  ], answer: 1},
  {question: "Vùng hiển thị nội dung trong File Explorer thường cho biết những thông tin nào?", options: [
    "Tên tệp/thư mục, thời điểm sửa đổi, kiểu tệp, kích thước.",
    "Chỉ số FPS của máy.",
    "Danh bạ điện thoại.",
    "Tốc độ mạng Wi‑Fi."
  ], answer: 0},
  {question: "Phần mở rộng (đuôi) của tên tệp là gì?", options: [
    "Các kí tự sau dấu chấm do phần mềm thêm vào để xác định loại tệp.",
    "Tên người tạo tệp.",
    "Mật khẩu của tệp.",
    "Kí hiệu của thư mục gốc."
  ], answer: 0},
  {question: "Đuôi nào thường thuộc tệp chương trình có thể thực thi?", options: [
    "docx.", "exe.", "txt.", "pdf."
  ], answer: 1},
  {question: "Đuôi tên tệp giúp hệ điều hành làm gì?", options: [
    "Nhận biết loại tệp và xác định phần mềm có thể mở tệp.",
    "Tăng dung lượng tệp.",
    "Giảm nhiễu khi phát âm thanh.",
    "Tự động dịch văn bản."
  ], answer: 0},
  {question: "Vì sao không nên tùy tiện sửa đổi đuôi tên tệp?", options: [
    "Có thể khiến tệp không mở đúng và hệ thống sẽ cảnh báo rủi ro.",
    "Giúp tệp chạy nhanh hơn nên càng đổi càng tốt.",
    "Đổi đuôi sẽ xóa sạch nội dung tệp.",
    "Không ảnh hưởng gì nên đổi tùy ý."
  ], answer: 0},
  {question: "Chức năng của Quick access trong File Explorer là gì?", options: [
    "Hiển thị và truy cập nhanh các tệp/thư mục thường dùng hoặc gần đây.",
    "Quét virus toàn bộ hệ thống.",
    "Điều chỉnh độ sáng màn hình.",
    "Cài đặt phần mềm mới."
  ], answer: 0},
  {question: "Bạn muốn nhanh chóng tìm tệp có kích thước lớn nhất trong một thư mục. Cách làm phù hợp nhất là?", options: [
    "Vào tab View, dùng Current view → Sort by → Size (giảm dần).",
    "Đổi tên tất cả các tệp theo số thứ tự.",
    "Xóa bớt tệp cho nhẹ máy rồi kiểm tra lại.",
    "Tắt máy và bật lại."
  ], answer: 0},
  {question: "Để luôn nhìn thấy đuôi tệp trong File Explorer, bạn cần thao tác gì?", options: [
    "Trong tab View, đánh dấu mục File name extensions.",
    "Trong tab Home, chọn Paste.",
    "Trong tab Share, chọn Zip.",
    "Trong tab View, chọn Dark mode."
  ], answer: 0}
];

    // ==== Xáo trộn ====
    function shuffle(arr) { for (let i = arr.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [arr[i], arr[j]] = [arr[j], arr[i]]; } return arr; }
    function withShuffledOptions(q) {
      const order = q.options.map((_, i) => i);
      shuffle(order);
      const options = order.map(i => q.options[i]);
      const answer = order.indexOf(q.answer);
      return { ...q, options, answer };
    }

    // ==== DOM ====
    const mainGameContainer = document.getElementById('main-game');
    const resultsContainer = document.getElementById('results-container');
    const questionText = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options-container');
    const feedbackText = document.getElementById('feedback-text');
    const nextBtn = document.getElementById('next-btn');
    const restartBtn = document.getElementById('restart-btn');
    const progressText = document.getElementById('progress');
    const scoreText = document.getElementById('score');
    const finalScoreText = document.getElementById('final-score');
    const scoreCommentText = document.getElementById('score-comment');
    const sendStatus = document.getElementById('send-status');

    // ==== State ====
    let currentQuestionIndex = 0;
    let score = 0;
    let shuffledQuestions = [];

    function startGame() {
      currentQuestionIndex = 0;
      score = 0;
      const prepared = quizData.map(withShuffledOptions);
      shuffledQuestions = shuffle(prepared.slice());
      chosen = new Array(shuffledQuestions.length).fill(null);
      mainGameContainer.classList.remove('hidden');
      resultsContainer.classList.add('hidden');
      updateScoreDisplay();
      loadQuestion();
    }

    function loadQuestion() {
      feedbackText.textContent = '';
      nextBtn.classList.add('hidden');
      optionsContainer.innerHTML = '';

      const current = shuffledQuestions[currentQuestionIndex];
      questionText.textContent = current.question;
      progressText.textContent = `Câu hỏi ${currentQuestionIndex + 1} / ${shuffledQuestions.length}`;

      current.options.forEach((option, index) => {
        const button = document.createElement('button');
        button.textContent = option;
        button.classList.add('option-btn','w-full','text-left','p-4','rounded-lg','border-2','border-gray-300','dark:border-gray-600','hover:bg-gray-100','dark:hover:bg-gray-600','transition-colors','duration-200','text-gray-700','dark:text-gray-200');
        button.dataset.index = index;
        button.addEventListener('click', selectAnswer);
        optionsContainer.appendChild(button);
      });
    }

    function selectAnswer(e) {
      const btn = e.target;
      const selectedIndex = parseInt(btn.dataset.index);
      const correctIndex = shuffledQuestions[currentQuestionIndex].answer;

      Array.from(optionsContainer.children).forEach(b => b.disabled = true);
      chosen[currentQuestionIndex] = selectedIndex;

      if (selectedIndex === correctIndex) {
        score += 10; updateScoreDisplay();
        btn.classList.add('correct');
        feedbackText.textContent = 'Chính xác! Rất tốt!';
        feedbackText.style.color = '#22c55e';
      } else {
        btn.classList.add('incorrect');
        feedbackText.textContent = 'Tiếc quá, sai rồi!';
        feedbackText.style.color = '#ef4444';
        optionsContainer.children[correctIndex].classList.add('correct');
      }

      nextBtn.classList.remove('hidden');
    }

    function nextQuestion() {
      currentQuestionIndex++;
      if (currentQuestionIndex < shuffledQuestions.length) loadQuestion();
      else showResults();
    }

    function showResults() {
      mainGameContainer.classList.add('hidden');
      resultsContainer.classList.remove('hidden');

      const total = shuffledQuestions.length;
      const percent = (score / (total * 10)) * 100;
      finalScoreText.textContent = `${score} / ${total * 10}`;
      if (percent === 100) scoreCommentText.textContent = 'Tuyệt vời! Bạn đã nắm vững kiến thức!';
      else if (percent >= 70) scoreCommentText.textContent = 'Làm tốt lắm! Bạn hiểu bài khá rõ.';
      else if (percent >= 50) scoreCommentText.textContent = 'Cố gắng hơn nhé! Hãy ôn lại bài một chút.';
      else scoreCommentText.textContent = 'Đừng nản lòng, hãy xem lại bài và thử lại nhé!';

      // Gửi dữ liệu
      if (sendStatus) sendStatus.textContent = 'Đang gửi kết quả…';
      const payload = {
        quizId: QUIZ_ID,
        name: document.getElementById('studentName')?.value || '',
        className: document.getElementById('studentClass')?.value || '',
        score,
        total: total * 10,
        answers: shuffledQuestions.map((q, i) => ({
          q: i + 1,
          question: q.question,
          selectedIndex: chosen[i],
          selectedText: (typeof chosen[i] === 'number' && q.options[chosen[i]] !== undefined) ? q.options[chosen[i]] : null,
          correctIndex: q.answer,
          correctText: q.options[q.answer]
        }))
      };

      // Lưu localStorage dự phòng
      try {
        const key = 'quizResults';
        const old = JSON.parse(localStorage.getItem(key) || '[]');
        old.push({ ...payload, timestamp: new Date().toISOString() });
        localStorage.setItem(key, JSON.stringify(old));
      } catch (e) {}

      fetch(ENDPOINT, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      }).then(() => {
        if (sendStatus) sendStatus.textContent = 'Đã gửi kết quả (nếu kết nối mạng ổn).';
      }).catch(() => {
        if (sendStatus) sendStatus.textContent = 'Không gửi được lên bảng (đã lưu tạm trên máy).';
      });
    }

    function updateScoreDisplay(){ scoreText.textContent = `Điểm: ${score}`; }

    nextBtn.addEventListener('click', nextQuestion);
    restartBtn?.addEventListener('click', startGame);

    startGame();
  </script>
</body>
</html>
